<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <!-- CACHE-FIX META TAGS -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ultimate Aesthetic Digital Clock</title>

  <!-- Tailwind CDN with version param (cache-busting) -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp&v=20251126" defer></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <style>
    :root{
      --glass-bg: rgba(255,255,255,0.06);
      --glass-border: rgba(255,255,255,0.08);
      --neon: #00ffd7;
      --accent-dark: rgba(0,255,215,0.12);
    }

    html,body{height:100%}
    body{
      font-family: "Orbitron", sans-serif;
      margin:0;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      transition: background .45s ease, color .45s ease;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      overflow:hidden;
    }

    /* DARK THEME */
    body.theme-dark{
      background: radial-gradient(circle at 10% 10%, #081022 0%, #020206 50%, #000000 100%);
      color: #dffbf7;
    }
    .dark-clock {
      text-shadow:
        0 0 6px rgba(0,255,215,0.8),
        0 0 14px rgba(0,255,215,0.45),
        0 0 32px rgba(0,170,255,0.15);
      color: var(--neon);
    }

    /* LIGHT THEME */
    body.theme-light{
      background: linear-gradient(180deg,#eef3fb 0%, #e6eaef 100%);
      color:#1f2937;
    }
    .light-clock {
      text-shadow: 2px 2px 6px rgba(0,0,0,0.06);
      color: #0f172a;
    }

    /* Glass box */
    .glass {
      border-radius: 18px;
      padding: 28px 40px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:14px;
      backdrop-filter: blur(10px) saturate(120%);
      transition: box-shadow .35s ease, background .35s ease, transform .25s ease;
      border: 1px solid rgba(255,255,255,0.04);
      max-width:980px;
      width:90%;
    }
    body.theme-light .glass{
      background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(245,247,250,0.6));
      border: 1px solid rgba(0,0,0,0.04);
      box-shadow: 14px 20px 40px rgba(190,200,215,0.45);
    }
    body.theme-dark .glass{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid rgba(0,255,215,0.06);
      box-shadow: 0 10px 40px rgba(0,0,0,0.6), 0 0 60px rgba(0,255,215,0.03);
    }

    /* Clock typography */
    .clock-row{display:flex; align-items:end; gap:12px; justify-content:center;}
    .digits{font-weight:700; letter-spacing:0.04em;}
    .hours, .minutes { font-size: clamp(48px, 9vw, 96px); }
    .seconds { font-size: clamp(28px, 5.5vw, 52px); opacity:.9; transform-origin:center; display:inline-block; }
    .ampm { font-size: clamp(14px,2.6vw,22px); align-self:flex-end; margin-bottom:6px; opacity:.85;}

    /* blinking separator */
    .sep{animation: blink 1s infinite;}
    @keyframes blink{50%{opacity:.25}}

    /* Buttons - centered */
    .controls{display:flex; gap:18px; margin-top:8px; align-items:center; justify-content:center;}
    .circle-btn{
      width:66px; height:66px; border-radius:999px; display:flex; align-items:center; justify-content:center;
      font-weight:700; cursor:pointer; user-select:none; transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
      border: none;
    }
    .circle-btn:active{ transform: translateY(2px) scale(.995) }

    /* dark button */
    .btn-dark{
      background: rgba(0,255,215,0.06);
      color: var(--neon);
      border: 1px solid rgba(0,255,215,0.12);
      box-shadow: 0 8px 30px rgba(0,255,215,0.04);
    }
    .btn-dark:hover{
      background: rgba(0,255,215,0.12);
      box-shadow: 0 12px 40px rgba(0,255,215,0.12);
    }

    /* light button */
    .btn-light{
      background: #eef3fb;
      color: #0f172a;
      box-shadow: 6px 6px 18px rgba(190,200,215,0.6), -6px -6px 18px rgba(255,255,255,0.8);
      border: 1px solid rgba(0,0,0,0.02);
    }
    .btn-light:hover{
      transform: translateY(-2px) scale(1.02);
      box-shadow: inset 6px 6px 20px rgba(190,200,215,0.25);
    }

    /* Info row */
    .info-row{display:flex; gap:18px; align-items:center; justify-content:center; margin-top:6px; flex-wrap:wrap;}
    .chip{
      padding:8px 12px; border-radius:999px; font-weight:600; font-size:14px;
      backdrop-filter: blur(6px);
    }
    body.theme-dark .chip{ background: rgba(0,0,0,0.28); color:var(--neon); border:1px solid rgba(0,255,215,0.06) }
    body.theme-light .chip{ background: rgba(255,255,255,0.7); color:#0f172a; border:1px solid rgba(0,0,0,0.04) }

    /* quote area */
    .quote{max-width:740px; text-align:center; font-size:clamp(14px,1.6vw,18px); opacity:.9; margin-top:8px;}

    /* particles canvas full screen behind content */
    #particles { position:fixed; inset:0; z-index:0; pointer-events:none; }

    /* responsive tweaks */
    @media (max-width:640px){
      .glass{padding:18px 20px;}
      .controls{gap:12px}
      .circle-btn{width:56px;height:56px}
    }
  </style>
</head>
<body class="theme-dark">

  <!-- particles canvas (z-index 0) -->
  <canvas id="particles"></canvas>

  <!-- main container (z-index > canvas) -->
  <main style="position:relative; z-index:2; width:100%; display:flex; align-items:center; justify-content:center; padding:40px 16px;">
    <section class="glass" role="region" aria-label="Aesthetic digital clock">
      <!-- clock -->
      <div class="clock-row" aria-hidden="false">
        <div class="digits hours dark-clock" id="hours">00</div>
        <div class="digits sep dark-clock">:</div>
        <div class="digits minutes dark-clock" id="minutes">00</div>
        <div class="digits sep dark-clock">:</div>
        <div class="digits seconds dark-clock" id="seconds">00</div>
        <div class="ampm dark-clock" id="ampm"></div>
      </div>

      <!-- date -->
      <div id="date" class="text-sm sm:text-base opacity-80 dark-clock"></div>

      <!-- chips: greeting, weather, format -->
      <div class="info-row" aria-hidden="true">
        <div id="greeting" class="chip">HELLO</div>
        <div id="weatherChip" class="chip">Weather: ‚Äî</div>
        <div id="formatChip" class="chip">24H</div>
      </div>

      <!-- quote -->
      <div id="quote" class="quote">‚ÄúLoading quote...‚Äù</div>

      <!-- controls (centered) -->
      <div class="controls" role="toolbar" aria-label="Clock controls">
        <button id="formatBtn" class="circle-btn btn-dark" title="Toggle 12H / 24H">24H</button>
        <button id="themeBtn" class="circle-btn btn-dark" title="Toggle Theme">‚òÄÔ∏è</button>
        <button id="refreshWeather" class="circle-btn btn-dark" title="Refresh Weather">‚ü≥</button>
      </div>
    </section>
  </main>

  <!-- SCRIPTS -->
  <script>
    /* ----------------- Utilities & State ----------------- */
    const state = {
      is24: true,
      theme: 'dark', // 'dark' or 'light'
      quoteIndex: 0
    };

    // Elements
    const elHours = document.getElementById('hours');
    const elMinutes = document.getElementById('minutes');
    const elSeconds = document.getElementById('seconds');
    const elAmpm = document.getElementById('ampm');
    const elDate = document.getElementById('date');
    const elGreeting = document.getElementById('greeting');
    const elWeatherChip = document.getElementById('weatherChip');
    const elFormatChip = document.getElementById('formatChip');
    const elQuote = document.getElementById('quote');

    const btnFormat = document.getElementById('formatBtn');
    const btnTheme = document.getElementById('themeBtn');
    const btnRefreshWeather = document.getElementById('refreshWeather');

    const body = document.body;

    /* ----------------- Quotes (local list) ----------------- */
    const quotes = [
      "Small steps every day ‚Äî that‚Äôs how mountains move.",
      "Design is the silent ambassador of your brand.",
      "Simplicity is the ultimate sophistication.",
      "The future is built by those who show up.",
      "Make it useful. Then make it beautiful.",
      "Code is poetry; write something worth reading.",
      "Good design is obvious. Great design is transparent."
    ];

    /* ----------------- Clock & UI Functions ----------------- */
    function updateClock(){
      const now = new Date();
      let h = now.getHours();
      let m = now.getMinutes();
      let s = now.getSeconds();

      // Greeting
      const hour = h;
      let greet = 'Hello';
      if(hour < 12) greet = 'Good Morning';
      else if(hour < 17) greet = 'Good Afternoon';
      else greet = 'Good Evening';
      elGreeting.textContent = greet;

      // Date
      const opts = { weekday:'long', month:'short', day:'numeric' };
      elDate.textContent = now.toLocaleDateString(undefined, opts).toUpperCase();

      // Format
      let ampm = '';
      if(!state.is24){
        ampm = h >= 12 ? 'PM' : 'AM';
        h = h % 12 || 12;
      }
      elHours.textContent = String(h).padStart(2,'0');
      elMinutes.textContent = String(m).padStart(2,'0');

      // seconds flip animation
      elSeconds.textContent = String(s).padStart(2,'0');
      elAmpm.textContent = ampm;

      // Add flip effect on seconds
      elSeconds.animate([
        { transform: 'rotateX(0deg)' },
        { transform: 'rotateX(-20deg)' },
        { transform: 'rotateX(0deg)' }
      ], { duration: 260, easing: 'cubic-bezier(.2,.9,.2,1)' });

      // update chips
      elFormatChip.textContent = state.is24 ? '24H' : '12H';
      btnFormat.textContent = state.is24 ? '24H' : '12H';
    }

    // initial quote
    function setQuote(){
      state.quoteIndex = (state.quoteIndex + 1) % quotes.length;
      elQuote.textContent = `‚Äú${quotes[state.quoteIndex]}‚Äù`;
    }

    /* ----------------- Theme toggle (safe classList usage) ----------------- */
    function applyTheme(theme){
      // set body classes but preserve others (do not overwrite)
      state.theme = theme;
      if(theme === 'dark'){
        body.classList.remove('theme-light');
        body.classList.add('theme-dark');
        // update button styles
        btnFormat.classList.remove('btn-light'); btnFormat.classList.add('btn-dark');
        btnTheme.classList.remove('btn-light'); btnTheme.classList.add('btn-dark');
        btnRefreshWeather.classList.remove('btn-light'); btnRefreshWeather.classList.add('btn-dark');

        // clock style switches
        document.querySelectorAll('.digits, .ampm, .sep').forEach(n => {
          n.classList.remove('light-clock');
          n.classList.add('dark-clock');
        });
        btnTheme.textContent = '‚òÄÔ∏è';
      } else {
        body.classList.remove('theme-dark');
        body.classList.add('theme-light');

        btnFormat.classList.remove('btn-dark'); btnFormat.classList.add('btn-light');
        btnTheme.classList.remove('btn-dark'); btnTheme.classList.add('btn-light');
        btnRefreshWeather.classList.remove('btn-dark'); btnRefreshWeather.classList.add('btn-light');

        document.querySelectorAll('.digits, .ampm, .sep').forEach(n => {
          n.classList.remove('dark-clock');
          n.classList.add('light-clock');
        });
        btnTheme.textContent = 'üåô';
      }
    }

    /* ----------------- Weather (Open-Meteo, no API key) ----------------- */
    // open-meteo docs: https://open-meteo.com/
    async function fetchWeather(lat, lon){
      try {
        // Open-Meteo endpoint: (current_weather)
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&timezone=auto`;
        const res = await fetch(url, { cache: "no-store" });
        if(!res.ok) throw new Error('Weather fetch failed');
        const data = await res.json();
        // data.current_weather: { temperature, windspeed, weathercode }
        const temp = data.current_weather?.temperature;
        const wind = data.current_weather?.windspeed;
        const code = data.current_weather?.weathercode;
        elWeatherChip.textContent = `üå§ ${temp ?? '‚Äî'}¬∞C ‚Ä¢ ${wind ?? '‚Äî'} km/h`;
      } catch (err){
        console.warn('Weather error', err);
        elWeatherChip.textContent = 'Weather: unavailable';
      }
    }

    // get location using Geolocation API (with fallback)
    async function initWeather(){
      elWeatherChip.textContent = 'Detecting weather‚Ä¶';
      if(!navigator.geolocation){
        elWeatherChip.textContent = 'Geolocation not supported';
        return;
      }
      // try to get position (short timeout)
      navigator.geolocation.getCurrentPosition(
        pos => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          fetchWeather(lat, lon);
        },
        err => {
          console.warn('Geolocation denied / error', err);
          // fallback: approximate via IP-based free service? skip to unavailable
          elWeatherChip.textContent = 'Weather: permission denied';
        },
        { enableHighAccuracy:false, timeout:8000, maximumAge:600000 }
      );
    }

    /* ----------------- Particles Background (simple, performant) ----------------- */
    (function particlesInit(){
      const canvas = document.getElementById('particles');
      const ctx = canvas.getContext('2d', { alpha:true });
      let W = canvas.width = innerWidth;
      let H = canvas.height = innerHeight;
      const particles = [];
      const count = Math.round((W*H)/90000); // scale particles with viewport

      function rand(min,max){ return Math.random()*(max-min)+min; }

      function resize(){ W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
      addEventListener('resize', resize);

      for(let i=0;i<count;i++){
        particles.push({
          x: rand(0,W), y: rand(0,H),
          r: rand(0.6,2.6),
          vx: rand(-0.15,0.15), vy: rand(-0.05,0.05),
          alpha: rand(0.05,0.5)
        });
      }

      function step(){
        ctx.clearRect(0,0,W,H);
        for(const p of particles){
          p.x += p.vx;
          p.y += p.vy;
          if(p.x < -10) p.x = W + 10;
          if(p.x > W + 10) p.x = -10;
          if(p.y < -10) p.y = H + 10;
          if(p.y > H + 10) p.y = -10;
          // glow style depends on theme
          ctx.beginPath();
          ctx.globalAlpha = p.alpha * (body.classList.contains('theme-dark') ? 1.0 : 0.9);
          if(body.classList.contains('theme-dark')){
            ctx.fillStyle = 'rgba(0,255,215,0.14)';
            ctx.shadowColor = 'rgba(0,255,215,0.12)';
            ctx.shadowBlur = 8;
          } else {
            ctx.fillStyle = 'rgba(45,55,72,0.06)';
            ctx.shadowColor = 'rgba(0,0,0,0.06)';
            ctx.shadowBlur = 6;
          }
          ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
          ctx.fill();
          ctx.closePath();
          ctx.shadowBlur = 0;
        }
        ctx.globalAlpha = 1;
        requestAnimationFrame(step);
      }
      step();
    })();

    /* ----------------- Service Worker Unregister (helps cache issues) ----------------- */
    (function unregisterSW(){
      if('serviceWorker' in navigator){
        navigator.serviceWorker.getRegistrations().then(regs => {
          regs.forEach(reg => {
            // Only unregister if it's not required by you; this helps clear old caches
            try { reg.unregister(); console.log('SW unregistered'); } catch(e){/*ignore*/ }
          });
        }).catch(e=>{/*ignore*/});
      }
    })();

    /* ----------------- Event Listeners / Init ----------------- */
    btnFormat.addEventListener('click', () => {
      state.is24 = !state.is24;
      updateClock();
    });

    btnTheme.addEventListener('click', () => {
      const newTheme = state.theme === 'dark' ? 'light' : 'dark';
      applyTheme(newTheme);
    });

    btnRefreshWeather.addEventListener('click', initWeather);

    // initial setup
    applyTheme('dark');           // default theme
    setQuote();
    updateClock();
    initWeather();

    // clock ticking every second
    setInterval(updateClock, 1000);

    // rotate quotes every 12s
    setInterval(setQuote, 12000);

    /* ----------------- Helpful: Listen for page show (bfcache / back-forward cache) and refresh weather */
    addEventListener('pageshow', event => {
      // if persisted from bfcache, re-run critical init
      if(event.persisted){
        updateClock();
        initWeather();
      }
    });

    /* ----------------- END ----------------- */
  </script>
</body>
</html>
